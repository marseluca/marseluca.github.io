<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Asta Fantacalcio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding-top: 30px; 
      background: #fafafa;
    }
    h1 {
      text-align: center;
      margin: 20px 0 10px 0;
    }
    .top-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .btn-main {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 15px;
      cursor: pointer;
    }
    .btn-main:hover {
      background-color: #0056b3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    .delete-btn {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      border-radius: 50%;
      font-weight: bold;
    }
    .delete-btn:hover {
      background-color: #b02a37;
    }

    /* Etichette Ruoli */
    .role-label {
      display: inline-block;
      color: white;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
    }
    .role-P { background-color: #28a745; }
    .role-D { background-color: #007bff; }
    .role-C { background-color: #fd7e14; }
    .role-A { background-color: #dc3545; }

    /* Popup (modal) */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      max-width: 600px;
      width: 90%;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0px 2px 10px rgba(0,0,0,0.3);
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .close-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      float: right;
    }
    .delete-all-btn, .info-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      color: white;
      border: none;
      font-size: 14px;
    }
    .delete-all-btn {
      background-color: #dc3545;
    }
    .delete-all-btn:hover { background-color: #b02a37; }
    .info-btn {
      background-color: #6c757d;
    }
    .info-btn:hover { background-color: #495057; }

    /* Tabella riepilogo */
    .summary {
      margin-top: 20px;
    }
    .summary table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 10px;
    }
    .summary th, .summary td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    .summary th {
      background: #eee;
    }

    .budget-input {
      margin: 10px 0;
      text-align: left;
    }
    .budget-input label {
      font-weight: bold;
      margin-right: 10px;
    }
    .budget-input input {
      width: 120px;
      padding: 6px;
    }

    /* Form interno al popup */
    .popup-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }
    .popup-form input, .popup-form select, .popup-form button {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .popup-form button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .popup-form button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Gestore Asta</h1>

  <div class="top-buttons">
    <button class="btn-main" onclick="openAdd()">‚ûï Aggiungi</button>
    <button class="btn-main" onclick="openOptions()">‚öôÔ∏è Opzioni</button>
  </div>

  <table id="playersTable" style="display:none;">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Crediti</th>
        <th>Ruolo</th>
        <th>Azione</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Popup Aggiungi -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeAdd()">Chiudi</button>
      <h2>Aggiungi Calciatore</h2>
      <form id="playerForm" class="popup-form" autocomplete="off">
        <input type="text" id="nome" placeholder="Nome Calciatore" required autocomplete="off">
        <input type="number" id="crediti" placeholder="Crediti Spesi" min="1" required>
        <select id="ruolo" required>
          <option value="">Seleziona Ruolo</option>
          <option value="Portiere">Portiere</option>
          <option value="Difensore">Difensore</option>
          <option value="Centrocampista">Centrocampista</option>
          <option value="Attaccante">Attaccante</option>
        </select>
        <button type="submit">Aggiungi</button>
      </form>
    </div>
  </div>

  <!-- Popup Opzioni -->
  <div id="optionsModal" class="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeOptions()">Chiudi</button>
      <h2>Opzioni</h2>
      <button class="delete-all-btn" onclick="deleteAll()">üóëÔ∏è Elimina Tutto</button>
      <button class="info-btn" onclick="openInfo()">‚ÑπÔ∏è Info</button>

      <!-- Campo Budget -->
      <div class="budget-input">
        <label for="budgetInput">Budget:</label>
        <input type="number" id="budgetInput" value="1000" min="0">
      </div>

      <!-- Riepilogo crediti -->
      <div class="summary" id="summaryBox">
        <table>
          <thead>
            <tr>
              <th><span class="role-label role-P">P</span></th>
              <th><span class="role-label role-D">D</span></th>
              <th><span class="role-label role-C">C</span></th>
              <th><span class="role-label role-A">A</span></th>
              <th>Rimanenti</th>
            </tr>
          </thead>
          <tbody id="summaryTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Popup Info -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeInfo()">Chiudi</button>
      <h2>Come usare il Gestore Asta</h2>
      <p>‚úÖ Premi <b>Aggiungi</b>, inserisci <b>Nome</b>, <b>Crediti</b> e <b>Ruolo</b>, poi conferma.</p>
      <p>üìã Il giocatore verr√† aggiunto alla tabella principale e i dati saranno salvati in locale sul tuo browser.</p>
      <p>üóëÔ∏è Puoi eliminare singoli giocatori con la <b>X</b> rossa o usare <b>Elimina tutto</b> dalle Opzioni.</p>
      <p>üìä Nelle Opzioni puoi modificare il <b>Budget</b> e visualizzare i crediti spesi e rimanenti per ruolo.</p>
    </div>
  </div>

  <script>
    const table = document.getElementById("playersTable");
    const tableBody = document.querySelector("#playersTable tbody");
    const summaryTableBody = document.getElementById("summaryTableBody");
    const optionsModal = document.getElementById("optionsModal");
    const infoModal = document.getElementById("infoModal");
    const addModal = document.getElementById("addModal");
    const budgetInput = document.getElementById("budgetInput");
    const form = document.getElementById("playerForm");

    let budgetTotale = parseInt(budgetInput.value);
    let players = JSON.parse(localStorage.getItem("players")) || [];

    const rolesOrder = ["Portiere", "Difensore", "Centrocampista", "Attaccante"];
    const roleLabels = {
      "Portiere": '<span class="role-label role-P">P</span>',
      "Difensore": '<span class="role-label role-D">D</span>',
      "Centrocampista": '<span class="role-label role-C">C</span>',
      "Attaccante": '<span class="role-label role-A">A</span>'
    };

    function renderTable() {
      table.style.display = players.length > 0 ? "table" : "none";
      players.sort((a, b) => rolesOrder.indexOf(a.ruolo) - rolesOrder.indexOf(b.ruolo));
      tableBody.innerHTML = "";
      players.forEach((player, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${player.nome}</td>
          <td>${player.crediti}</td>
          <td>${roleLabels[player.ruolo]}</td>
          <td><button class="delete-btn" onclick="deletePlayer(${index})">X</button></td>
        `;
        tableBody.appendChild(row);
      });
      renderSummary();
    }

    function savePlayers() {
      localStorage.setItem("players", JSON.stringify(players));
    }

    function renderSummary() {
      let summaryData = { "Portiere": 0, "Difensore": 0, "Centrocampista": 0, "Attaccante": 0 };
      let totaleSpeso = 0;
      players.forEach(player => {
        summaryData[player.ruolo] += parseInt(player.crediti);
        totaleSpeso += parseInt(player.crediti);
      });
      let rimanenti = budgetTotale - totaleSpeso;
      summaryTableBody.innerHTML = `
        <tr>
          <td>${summaryData["Portiere"]}</td>
          <td>${summaryData["Difensore"]}</td>
          <td>${summaryData["Centrocampista"]}</td>
          <td>${summaryData["Attaccante"]}</td>
          <td>${rimanenti}</td>
        </tr>
      `;
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const nome = document.getElementById("nome").value.trim();
      const crediti = document.getElementById("crediti").value;
      const ruolo = document.getElementById("ruolo").value;
      if (nome && crediti && ruolo) {
        players.push({ nome, crediti: parseInt(crediti), ruolo });
        savePlayers();
        renderTable();
        form.reset();
        closeAdd(); // chiudi popup dopo aggiunta
      }
    });

    window.deletePlayer = function(index) {
      players.splice(index, 1);
      savePlayers();
      renderTable();
    };

    window.deleteAll = function() {
      if (confirm("Vuoi eliminare tutti i calciatori dalla lista?")) {
        players = [];
        savePlayers();
        renderTable();
      }
    };

    // Gestione modali
    window.openOptions = () => optionsModal.style.display = "flex";
    window.closeOptions = () => optionsModal.style.display = "none";
    window.openInfo = () => infoModal.style.display = "flex";
    window.closeInfo = () => infoModal.style.display = "none";
    window.openAdd = () => addModal.style.display = "flex";
    window.closeAdd = () => addModal.style.display = "none";

    budgetInput.addEventListener("input", () => {
      budgetTotale = parseInt(budgetInput.value) || 0;
      renderSummary();
    });

    renderTable();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prefissa IPFS con dweb.link/ipfs/</title>
  <style>
    :root {
      --bg: #0f172a;       /* ardesia scura */
      --card: #111827;     /* grigio molto scuro */
      --text: #e5e7eb;     /* grigio chiaro */
      --muted: #94a3b8;
      --accent: #22c55e;   /* verde */
      --accent-press: #16a34a;
      --ring: #34d39955;
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #0f172a;
        --muted: #475569;
        --ring: #10b98133;
      }
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px 800px at 50% -200px, #10b98122, transparent 60%), var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
    }
    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 20px 16px;
    }
    .card {
      width: 100%;
      max-width: 640px;
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.06);
    }
    h1 {
      margin: 0 0 8px;
      font-size: clamp(1.25rem, 1rem + 1.2vw, 1.8rem);
      line-height: 1.2;
    }
    p.lead {
      margin: 0 0 20px;
      color: var(--muted);
      font-size: 0.98rem;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    input[type="text"] {
      width: 100%;
      font-size: 1.05rem;
      padding: 14px 16px;
      background: transparent;
      color: var(--text);
      border: 1.5px solid rgba(148,163,184,.35);
      border-radius: 12px;
      outline: none;
      transition: box-shadow .15s, border-color .15s, transform .04s;
    }
    input[type="text"]::placeholder { color: #94a3b8aa; }
    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 6px var(--ring);
    }
    button {
      width: 100%;
      font-size: 1.05rem;
      font-weight: 700;
      padding: 14px 16px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(180deg, var(--accent), var(--accent-press));
      color: #06281a;
      cursor: pointer;
      transition: transform .04s ease, filter .15s ease;
    }
    button:active { transform: translateY(1px) scale(0.998); }
    .help {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--muted);
    }
    .hint {
      margin-top: 14px;
      font-size: 0.86rem;
      color: var(--muted);
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px dashed rgba(148,163,184,.4);
    }
    @media (min-width: 480px) {
      .row {
        grid-template-columns: 1fr auto;
        align-items: center;
      }
      button { width: auto; padding-inline: 20px; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" role="region" aria-labelledby="titolo">
      <h1 id="titolo">Genera rapidamente un URL IPFS su dweb.link</h1>
      <p class="lead">Inserisci un CID o un percorso IPFS e il campo verrà riscritto con il prefisso <code>dweb.link/ipfs/</code> per ottenere un URL gateway pronto da incollare.</p>

      <form id="form" class="form" autocomplete="off">
        <label for="input">CID o percorso</label>
        <div class="row">
          <input
            id="input"
            type="text"
            inputmode="latin"
            placeholder="Es. Qm... oppure /ipfs/Qm... oppure cartella/file.jpg"
            aria-describedby="help"
            autofocus
          />
          <button type="submit" aria-label="Prefissa con dweb.link/ipfs/">Prefissa</button>
        </div>
        <div id="help" class="help">Suggerimento: premi Invio o tocca “Prefissa”.</div>
        <div class="hint">
          <span class="chip">Niente doppio prefisso</span>
          <span class="chip">Rimuove slash extra</span>
          <span class="chip">Funziona anche con /ipfs/…</span>
        </div>
      </form>
    </section>
  </main>

  <script>
    (function () {
      const PREFIX = "dweb.link/ipfs/";
      const input = document.getElementById("input");
      const form = document.getElementById("form");

      function normalize(value) {
        if (!value) return "";
        let v = value.trim();

        // Se inizia già con dweb.link/ipfs/, non fare nulla
        if (v.toLowerCase().startsWith(PREFIX)) return v;

        // Se l'utente ha inserito un URL con protocollo, estrai la parte dopo /ipfs/
        try {
          if (/^https?:\/\//i.test(v)) {
            const url = new URL(v);
            // prova a trovare /ipfs/<...> nel path
            const match = url.pathname.match(/\/ipfs\/(.+)/i);
            if (match && match[1]) v = match[1];
            else v = v.replace(/^https?:\/\//i, ""); // fallback minimale
          }
        } catch (_) {
          // non è un URL valido: ignora
        }

        // Se l'input è tipo /ipfs/<cid>/path -> estrai dopo /ipfs/
        v = v.replace(/^\/?ipfs\/+/i, "");

        // Togli eventuali slash iniziali
        v = v.replace(/^\/+/, "");

        // Evita duplicazioni come dweb.link/ipfs/dweb.link/ipfs/...
        v = v.replace(new RegExp("^" + PREFIX.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"), "i"), "");

        return PREFIX + v;
      }

      function convertAndReplace(ev) {
        ev.preventDefault();
        const current = input.value;
        if (!current.trim()) {
          input.focus();
          return;
        }
        const converted = normalize(current);
        input.value = converted;
        // Seleziona tutto per facilitare il copia/incolla su mobile
        input.setSelectionRange(0, converted.length);
        // Annuncia ai lettori di schermo
        input.setAttribute("aria-live", "polite");
      }

      // Converti al submit (Invio o click)
      form.addEventListener("submit", convertAndReplace);

      // Opzionale: se l'utente incolla un valore, puoi convertire subito con doppio tap su mobile
      input.addEventListener("keydown", (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === "k") {
          // scorciatoia: Cmd/Ctrl+K per convertire
          e.preventDefault();
          convertAndReplace(e);
        }
      });
    })();
  </script>
</body>
</html>
